"use strict";(self.webpackChunkdepositodwfront=self.webpackChunkdepositodwfront||[]).push([[73],{1904:(e,o,i)=>{i.r(o),i.d(o,{DepositoPage:()=>ie});var n=i(5043),r=i(3216),l=i(3003),s=i(6240),a=i(344),t=i(4150),d=i(6446),c=i(5865),u=i(1906),p=i(3845),x=i(9414),v=i(9824),m=i(7392),h=i(279),g=i(141),A=i(2101),j=i(8293),f=i(1973),b=i(3560),k=i(6223),y=i(579);const C=n.memo((e=>{let{posicion:o,onClick:i,onAdicionRapida:r,onMovimientoInterno:l,onCorreccion:t,searchTerm:u="",children:p}=e;const[x,v]=(0,n.useState)(!1),C=(0,s.A)(),S=(0,a.A)(C.breakpoints.down("sm")),w=((0,a.A)(C.breakpoints.down("md")),(0,k.uQ)(o)),I=(0,n.useMemo)((()=>{if(!u.trim()||!o.items)return o.items||[];const e=u.toLowerCase().trim().split(/\s+/);return o.items.filter((o=>{var i;const n=[o.categoria||"",o.descripcion||"",o.partida||"",(null===(i=o.proveedor)||void 0===i?void 0:i.nombre)||""].join(" ").toLowerCase();return e.every((e=>n.includes(e)))}))}),[o.items,u]),W=((0,n.useMemo)((()=>I.reduce(((e,o)=>e+(o.kilos||0)),0)),[I]),(0,n.useMemo)((()=>I.reduce(((e,o)=>e+(o.unidades||0)),0)),[I]),(e,i)=>{e.stopPropagation(),null===l||void 0===l||l(i,o)}),P=(e,i)=>{e.stopPropagation(),null===t||void 0===t||t(i,o)},M=I.length>(S?2:3);return u.trim()&&0===I.length?null:(0,y.jsxs)(d.A,{sx:{backgroundColor:"var(--color-surface)",borderRadius:"var(--border-radius-md)",border:"1px solid var(--color-border)",p:S?1.5:2,mb:2,cursor:"pointer",transition:"var(--transition-normal)","&:hover":{boxShadow:"var(--shadow-md)",transform:"translateY(-1px)"}},onClick:e=>{e.stopPropagation(),null===i||void 0===i||i(o)},children:[(0,y.jsxs)(d.A,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:1.5},children:[(0,y.jsx)(c.A,{variant:S?"body2":"h6",sx:{fontWeight:600,color:"var(--color-text-primary)",flex:1},children:w}),(0,y.jsxs)(d.A,{sx:{display:"flex",gap:.5},children:[(0,y.jsx)(m.A,{size:"small",onClick:e=>{e.stopPropagation(),null===r||void 0===r||r(o)},sx:{color:"var(--color-primary)",backgroundColor:"rgba(46, 125, 50, 0.1)","&:hover":{backgroundColor:"var(--color-primary)",color:"white"},p:.5},children:(0,y.jsx)(g.A,{fontSize:"small"})}),M&&(0,y.jsx)(m.A,{size:"small",onClick:e=>{e.stopPropagation(),v(!x)},sx:{color:"var(--color-text-secondary)",p:.5},children:x?(0,y.jsx)(A.A,{}):(0,y.jsx)(j.A,{})})]})]}),(0,y.jsx)(d.A,{sx:{mb:1.5},children:I.slice(0,S?2:3).map(((e,o)=>{var i,n;return(0,y.jsxs)(d.A,{sx:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",py:1,borderBottom:o<(S?1:2)?"1px solid var(--color-divider)":"none"},children:[(0,y.jsxs)(d.A,{sx:{flex:1,minWidth:0},children:[(0,y.jsxs)(c.A,{variant:S?"caption":"body2",sx:{fontWeight:600,color:"var(--color-text-primary)",mb:.5,lineHeight:1.3},children:[(null===(i=e.proveedor)||void 0===i?void 0:i.nombre)&&(0,y.jsxs)(d.A,{component:"span",sx:{color:"var(--color-secondary)",fontWeight:500},children:[e.proveedor.nombre," -"]}),e.categoria&&"".concat(e.categoria," - "),e.descripcion||"Sin descripci\xf3n"]}),(0,y.jsxs)(c.A,{variant:"caption",sx:{color:"var(--color-text-secondary)",display:"block"},children:[null===(n=e.kilos)||void 0===n?void 0:n.toFixed(1)," kg \u2022 ",e.unidades," uds",e.partida&&" \u2022 P: ".concat(e.partida)]})]}),(0,y.jsxs)(d.A,{sx:{display:"flex",gap:.5,ml:1,mt:.5},children:[(0,y.jsx)(m.A,{size:"small",onClick:o=>W(o,e),sx:{color:"var(--color-secondary)",p:.5},children:(0,y.jsx)(f.A,{fontSize:"small"})}),(0,y.jsx)(m.A,{size:"small",onClick:o=>P(o,e),sx:{color:"var(--color-warning)",p:.5},children:(0,y.jsx)(b.A,{fontSize:"small"})})]})]},o)}))}),(0,y.jsx)(h.A,{in:x,children:(0,y.jsx)(d.A,{sx:{mt:1},children:I.slice(S?2:3).map(((e,o)=>{var i,n;return(0,y.jsxs)(d.A,{sx:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",py:1,borderBottom:o<I.length-(S?2:3)-1?"1px solid var(--color-divider)":"none"},children:[(0,y.jsxs)(d.A,{sx:{flex:1,minWidth:0},children:[(0,y.jsxs)(c.A,{variant:"caption",sx:{fontWeight:600,color:"var(--color-text-primary)",mb:.5,lineHeight:1.3},children:[(null===(i=e.proveedor)||void 0===i?void 0:i.nombre)&&(0,y.jsxs)(d.A,{component:"span",sx:{color:"var(--color-secondary)",fontWeight:500},children:[e.proveedor.nombre," -"]}),e.categoria&&"".concat(e.categoria," - "),e.descripcion||"Sin descripci\xf3n"]}),(0,y.jsxs)(c.A,{variant:"caption",sx:{color:"var(--color-text-secondary)",display:"block"},children:[null===(n=e.kilos)||void 0===n?void 0:n.toFixed(1)," kg \u2022 ",e.unidades," uds",e.partida&&" \u2022 P: ".concat(e.partida)]})]}),(0,y.jsxs)(d.A,{sx:{display:"flex",gap:.5,ml:1,mt:.5},children:[(0,y.jsx)(m.A,{size:"small",onClick:o=>W(o,e),sx:{color:"var(--color-secondary)",p:.5},children:(0,y.jsx)(f.A,{fontSize:"small"})}),(0,y.jsx)(m.A,{size:"small",onClick:o=>P(o,e),sx:{color:"var(--color-warning)",p:.5},children:(0,y.jsx)(b.A,{fontSize:"small"})})]})]},"expanded-".concat(o))}))})}),p]})})),S=e=>{let{posiciones:o,onPosicionClick:i,onAdicionRapida:n,onMovimientoInterno:r,onCorreccion:l,searchTerm:t=""}=e;const u=(0,s.A)(),p=(0,a.A)(u.breakpoints.down("sm"));return 0===o.length?(0,y.jsxs)(d.A,{sx:{textAlign:"center",py:4,color:"var(--color-text-secondary)"},children:[(0,y.jsx)(c.A,{variant:p?"body2":"h6",children:"No se encontraron posiciones"}),t&&(0,y.jsx)(c.A,{variant:"caption",sx:{mt:1,display:"block"},children:"Intenta con otros t\xe9rminos de b\xfasqueda"})]}):(0,y.jsx)(d.A,{sx:{display:"flex",flexDirection:"column",gap:p?1:2},children:o.map(((e,o)=>{const s=e.posicionId||"posicion-".concat(o);return(0,y.jsx)(C,{posicion:e,onClick:i,onAdicionRapida:n,onMovimientoInterno:r,onCorreccion:l,searchTerm:t},s)}))})};var w=i(35),I=i(6600),W=i(5316),P=i(5795),M=i(9347),z=i(3193),D=i(9190),E=i(1199),F=i(2143),L=i(7254),T=i(5705),N=i(2410),R=i(6213);const O="https://derwill-deposito-backend.onrender.com",q=["costura","algodon","algodon-color","nylon","nylon REC","nylon-color","lycra","lycra REC","goma","tarugo","etiqueta","bolsa","percha","ribbon","caja","cinta","plantilla","film","consumibes(aceite y parafina)","faja","caballete"],U=e=>{let{open:o,onClose:i,onProveedorCreado:r}=e;const[l,s]=(0,n.useState)(""),[a,t]=(0,n.useState)(!1);return(0,y.jsxs)(w.A,{open:o,onClose:i,children:[(0,y.jsx)(I.A,{children:"Agregar Nuevo Proveedor"}),(0,y.jsx)(W.A,{children:(0,y.jsx)(P.A,{autoFocus:!0,margin:"dense",label:"Nombre del Proveedor",type:"text",fullWidth:!0,value:l,onChange:e=>s(e.target.value)})}),(0,y.jsxs)(M.A,{children:[(0,y.jsx)(u.A,{onClick:i,color:"primary",children:"Cancelar"}),(0,y.jsx)(u.A,{onClick:async()=>{if(l.trim()){t(!0);try{const e=await R.A.post("".concat(O,"/proveedores"),{nombre:l,categoria:"proveedor"});r(e.data),s(""),i()}catch(e){alert("Error al crear el proveedor"),console.error(e)}finally{t(!1)}}else alert("Por favor ingrese un nombre de proveedor")},color:"primary",disabled:a,children:"Guardar"})]})]})},B=e=>{let{open:o,onClose:i,proveedor:r,onItemCreado:l}=e;const[s,a]=(0,n.useState)({descripcion:"",categoria:""}),[t,c]=(0,n.useState)(!1);return(0,y.jsxs)(w.A,{open:o,onClose:i,children:[(0,y.jsx)(I.A,{children:"Agregar Nuevo Item"}),(0,y.jsx)(W.A,{children:(0,y.jsxs)(d.A,{sx:{display:"flex",flexDirection:"column",gap:2,mt:2},children:[(0,y.jsxs)(z.A,{fullWidth:!0,children:[(0,y.jsx)(D.A,{children:"Categor\xeda"}),(0,y.jsx)(E.A,{value:s.categoria,label:"Categor\xeda",onChange:e=>a({...s,categoria:e.target.value}),children:q.map((e=>(0,y.jsx)(F.A,{value:e,children:e},e)))})]}),(0,y.jsx)(P.A,{label:"Descripci\xf3n",value:s.descripcion,onChange:e=>a({...s,descripcion:e.target.value}),fullWidth:!0,required:!0})]})}),(0,y.jsxs)(M.A,{children:[(0,y.jsx)(u.A,{onClick:i,children:"Cancelar"}),(0,y.jsx)(u.A,{onClick:async()=>{if(s.descripcion&&s.categoria){c(!0);try{const e=await R.A.post("".concat(O,"/items"),{descripcion:s.descripcion,categoria:s.categoria,proveedor:r});l(e.data),a({descripcion:"",categoria:""}),i()}catch(e){alert("Error al crear el item"),console.error(e)}finally{c(!1)}}else alert("Por favor complete todos los campos")},disabled:t,children:"Guardar"})]})]})},K=e=>{let{open:o,onClose:i,posicion:r,onSubmit:s}=e;const a=(0,l.wA)(),t=(0,l.d4)((e=>e.remitos.proveedores)),p=(0,l.d4)((e=>e.remitos.items||[])),[x,v]=(0,n.useState)({proveedor:"",item:"",kilos:"",unidades:"",partida:"",tipoMovimiento:"ajusteSUMA"}),[m,h]=(0,n.useState)(!1),[g,A]=(0,n.useState)(""),[j,f]=(0,n.useState)(!1),[b,k]=(0,n.useState)(!1),C=x.proveedor?p.filter((e=>{var o;return(null===(o=e.proveedor)||void 0===o?void 0:o.id)===x.proveedor.id})):[];(0,n.useEffect)((()=>{!o||t&&0!==t.length||a((0,N.LC)())}),[o,a,t]);const S=(e,o)=>{v((i=>({...i,[e]:o})))},z=()=>{m||(i(),v({proveedor:"",item:"",kilos:"",unidades:"",partida:"",tipoMovimiento:"ajusteSUMA"}),A(""))};return(0,y.jsxs)(y.Fragment,{children:[(0,y.jsxs)(w.A,{open:o,onClose:z,maxWidth:"sm",fullWidth:!0,children:[(0,y.jsxs)(I.A,{children:["Adici\xf3n R\xe1pida - ",null!==r&&void 0!==r&&r.pasillo?"Pasillo ".concat(r.pasillo):"Rack ".concat(null===r||void 0===r?void 0:r.rack," - Fila ").concat(null===r||void 0===r?void 0:r.fila," - Nivel ").concat(null===r||void 0===r?void 0:r.AB)]}),(0,y.jsx)(W.A,{children:(0,y.jsxs)(d.A,{sx:{mt:2,display:"flex",flexDirection:"column",gap:2},children:[g&&(0,y.jsx)(L.A,{severity:"error",sx:{mb:2},children:g}),(0,y.jsxs)(d.A,{sx:{display:"flex",flexDirection:"column",gap:1},children:[(0,y.jsx)(T.A,{options:t||[],getOptionLabel:e=>e&&e.nombre||"",value:x.proveedor,onChange:(e,o)=>S("proveedor",o),renderInput:e=>(0,y.jsx)(P.A,{...e,label:"Proveedor",required:!0,placeholder:"Buscar proveedor..."}),renderOption:(e,o)=>(0,y.jsx)(d.A,{component:"li",...e,children:o.nombre}),noOptionsText:"No se encontraron proveedores",loading:!t||0===t.length,loadingText:"Cargando proveedores...",filterOptions:(e,o)=>{let{inputValue:i}=o;return e.filter((e=>e.nombre.toLowerCase().includes(i.toLowerCase())))}}),(0,y.jsx)(u.A,{size:"small",onClick:()=>f(!0),sx:{color:"#2ecc71",alignSelf:"flex-start",textTransform:"none"},children:"+ Agregar nuevo proveedor"})]}),(0,y.jsxs)(d.A,{sx:{display:"flex",flexDirection:"column",gap:1},children:[(0,y.jsx)(T.A,{options:C,getOptionLabel:e=>e?"".concat(e.categoria||""," - ").concat(e.descripcion||""):"",value:x.item,onChange:(e,o)=>S("item",o),renderInput:e=>(0,y.jsx)(P.A,{...e,label:"Item",required:!0,placeholder:"Buscar item...",disabled:!x.proveedor}),renderOption:(e,o)=>(0,y.jsx)(d.A,{component:"li",...e,children:(0,y.jsxs)(d.A,{children:[(0,y.jsx)(c.A,{variant:"body2",fontWeight:"bold",children:o.categoria}),(0,y.jsx)(c.A,{variant:"body2",color:"textSecondary",children:o.descripcion})]})}),noOptionsText:x.proveedor?"No se encontraron items":"Seleccione un proveedor primero",filterOptions:(e,o)=>{let{inputValue:i}=o;return e.filter((e=>e.categoria.toLowerCase().includes(i.toLowerCase())||e.descripcion.toLowerCase().includes(i.toLowerCase())))}}),x.proveedor&&(0,y.jsx)(u.A,{size:"small",onClick:()=>k(!0),sx:{color:"#2ecc71",alignSelf:"flex-start",textTransform:"none"},children:"+ Agregar nuevo item"})]}),(0,y.jsx)(P.A,{fullWidth:!0,label:"Partida",value:x.partida,onChange:e=>S("partida",e.target.value),required:!0}),(0,y.jsxs)(d.A,{sx:{display:"flex",gap:2},children:[(0,y.jsx)(P.A,{fullWidth:!0,label:"Kilos",type:"number",inputProps:{step:1,min:0},value:x.kilos,onChange:e=>{const o=e.target.value;(""===o||/^\d+$/.test(o))&&S("kilos",o)},required:!0}),(0,y.jsx)(P.A,{fullWidth:!0,label:"Unidades",type:"number",inputProps:{step:1,min:0},value:x.unidades,onChange:e=>{const o=e.target.value;(""===o||/^\d+$/.test(o))&&S("unidades",o)},required:!0})]})]})}),(0,y.jsxs)(M.A,{children:[(0,y.jsx)(u.A,{onClick:z,disabled:m,children:"Cancelar"}),(0,y.jsx)(u.A,{onClick:async()=>{if(x.proveedor&&x.item&&x.partida&&x.kilos&&x.unidades){h(!0),A("");try{const e={proveedor:x.proveedor,tipoMovimiento:x.tipoMovimiento,item:{itemId:x.item.id,categoria:x.item.categoria,descripcion:x.item.descripcion,proveedor:x.item.proveedor,partida:x.partida,kilos:0,unidades:0},kilos:parseInt(x.kilos),unidades:parseInt(x.unidades),partida:x.partida,posicion:(null===r||void 0===r?void 0:r.id)||(null===r||void 0===r?void 0:r.posicionId)||""};s(e),i(),v({proveedor:"",item:"",kilos:"",unidades:"",partida:"",tipoMovimiento:"ajusteSUMA"})}catch(g){A("Error al agregar el item. Por favor intente nuevamente.")}finally{h(!1)}}else A("Por favor complete todos los campos")},variant:"contained",disabled:m,children:m?"Agregando...":"Agregar"})]})]}),(0,y.jsx)(U,{open:j,onClose:()=>f(!1),onProveedorCreado:e=>{a((0,N.LC)()),v((o=>({...o,proveedor:e})))}}),(0,y.jsx)(B,{open:b,onClose:()=>k(!1),proveedor:x.proveedor,onItemCreado:e=>{a((0,N.LC)()),v((o=>({...o,item:e})))}})]})};var G=i(3438),H=i(8970),V=i(1088);const Y=e=>{let{open:o,onClose:i,item:r,posicionOrigen:l,onSubmit:t}=e;const x=(0,s.A)(),[v,h]=((0,a.A)(x.breakpoints.down("sm")),(0,n.useState)({rack:"",fila:"",nivel:"",pasillo:"",unidades:"",kilos:""})),[g,A]=(0,n.useState)({}),[j,b]=(0,n.useState)("rack");if((0,n.useEffect)((()=>{o&&r&&k()}),[o,r]),(0,n.useEffect)((()=>{if(o&&(!r||!l)){const e=setTimeout((()=>{i()}),3e3);return()=>clearTimeout(e)}}),[o,r,l,i]),!o)return null;if(!r||!l)return(0,y.jsx)(w.A,{open:o,onClose:i,maxWidth:"sm",fullWidth:!0,children:(0,y.jsx)(W.A,{children:(0,y.jsx)(d.A,{sx:{display:"flex",justifyContent:"center",p:3},children:(0,y.jsx)(c.A,{color:"error",children:"Error: No se pudo cargar la informaci\xf3n necesaria para el movimiento interno."})})})});const k=()=>{h({rack:"",fila:"",nivel:"",pasillo:"",unidades:(null===r||void 0===r?void 0:r.unidades)||0,kilos:(null===r||void 0===r?void 0:r.kilos)||0}),A({}),b("rack")},C=(e,o)=>{h((i=>({...i,[e]:o}))),g[e]&&A((o=>({...o,[e]:""})))},S=e=>{b(e),h("rack"===e?e=>({...e,pasillo:""}):e=>({...e,rack:"",fila:"",nivel:""}))},T=()=>"rack"===j?v.rack&&v.fila&&v.nivel:v.pasillo,N=()=>{k(),i()};return(0,y.jsxs)(w.A,{open:o,onClose:N,maxWidth:"md",fullWidth:!0,PaperProps:{sx:{borderRadius:"var(--border-radius-lg)",boxShadow:"var(--shadow-lg)"}},children:[(0,y.jsxs)(I.A,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",pb:1},children:[(0,y.jsxs)(d.A,{sx:{display:"flex",alignItems:"center",gap:1},children:[(0,y.jsx)(f.A,{sx:{color:"var(--color-secondary)",fontSize:28}}),(0,y.jsx)(c.A,{variant:"h6",sx:{fontWeight:600},children:"Mover Stock"})]}),(0,y.jsx)(m.A,{onClick:N,size:"small",children:(0,y.jsx)(G.A,{})})]}),(0,y.jsx)(W.A,{sx:{p:3},children:(0,y.jsxs)(d.A,{sx:{display:"flex",flexDirection:"column",gap:3},children:[(0,y.jsx)(V.A,{title:"Material a Mover",subtitle:"Informaci\xf3n del stock disponible",padding:"compact",sx:{mb:0},children:(0,y.jsxs)(d.A,{sx:{display:"flex",flexDirection:"column",gap:2},children:[(0,y.jsxs)(d.A,{sx:{display:"flex",alignItems:"center",gap:1},children:[(0,y.jsx)(H.A,{sx:{color:"var(--color-primary)",fontSize:20}}),(0,y.jsxs)(c.A,{variant:"body1",sx:{fontWeight:600},children:[null===r||void 0===r?void 0:r.categoria," - ",null===r||void 0===r?void 0:r.descripcion]})]}),(0,y.jsxs)(d.A,{sx:{display:"flex",flexWrap:"wrap",gap:1},children:[(0,y.jsx)(p.A,{label:"".concat((null===r||void 0===r?void 0:r.unidades)||0," unidades"),color:"primary",size:"small",variant:"outlined"}),(0,y.jsx)(p.A,{label:"".concat(((null===r||void 0===r?void 0:r.kilos)||0).toFixed(2)," kg"),color:"secondary",size:"small",variant:"outlined"}),(null===r||void 0===r?void 0:r.partida)&&(0,y.jsx)(p.A,{label:"P: ".concat(r.partida),color:"default",size:"small",variant:"outlined"})]})]})}),(0,y.jsx)(V.A,{title:"Destino",subtitle:"Seleccione la nueva ubicaci\xf3n",padding:"compact",sx:{mb:0},children:(0,y.jsxs)(d.A,{sx:{display:"flex",flexDirection:"column",gap:2},children:[(0,y.jsxs)(d.A,{sx:{display:"flex",gap:1},children:[(0,y.jsx)(u.A,{variant:"rack"===j?"contained":"outlined",size:"small",onClick:()=>S("rack"),sx:{flex:1,backgroundColor:"rack"===j?"var(--color-primary)":"transparent"},children:"Rack/Fila/Nivel"}),(0,y.jsx)(u.A,{variant:"pasillo"===j?"contained":"outlined",size:"small",onClick:()=>S("pasillo"),sx:{flex:1,backgroundColor:"pasillo"===j?"var(--color-primary)":"transparent"},children:"Pasillo"})]}),"rack"===j?(0,y.jsxs)(d.A,{sx:{display:"flex",gap:2,flexWrap:"wrap"},children:[(0,y.jsxs)(z.A,{size:"small",sx:{minWidth:100,flex:1},children:[(0,y.jsx)(D.A,{children:"Rack"}),(0,y.jsx)(E.A,{value:v.rack,onChange:e=>C("rack",e.target.value),label:"Rack",children:[...Array(20)].map(((e,o)=>(0,y.jsxs)(F.A,{value:o+1,children:["R",o+1]},o+1)))})]}),(0,y.jsxs)(z.A,{size:"small",sx:{minWidth:100,flex:1},children:[(0,y.jsx)(D.A,{children:"Fila"}),(0,y.jsx)(E.A,{value:v.fila,onChange:e=>C("fila",e.target.value),label:"Fila",children:[...Array(14)].map(((e,o)=>(0,y.jsxs)(F.A,{value:o+1,children:["F",o+1]},o+1)))})]}),(0,y.jsxs)(z.A,{size:"small",sx:{minWidth:100,flex:1},children:[(0,y.jsx)(D.A,{children:"Nivel"}),(0,y.jsx)(E.A,{value:v.nivel,onChange:e=>C("nivel",e.target.value),label:"Nivel",children:["A","B"].map((e=>(0,y.jsx)(F.A,{value:e,children:e},e)))})]})]}):(0,y.jsxs)(z.A,{size:"small",fullWidth:!0,children:[(0,y.jsx)(D.A,{children:"Pasillo"}),(0,y.jsx)(E.A,{value:v.pasillo,onChange:e=>C("pasillo",e.target.value),label:"Pasillo",children:[...Array(12)].map(((e,o)=>(0,y.jsxs)(F.A,{value:o,children:["Pasillo ",o]},o)))})]}),g.location&&(0,y.jsx)(L.A,{severity:"error",sx:{mt:1},children:g.location})]})}),(0,y.jsxs)(V.A,{title:"Cantidad",subtitle:"Especifique cu\xe1nto stock mover",padding:"compact",sx:{mb:0},children:[(0,y.jsx)(P.A,{fullWidth:!0,label:"Unidades a mover",type:"number",value:v.unidades,onChange:e=>{const o=parseInt(e.target.value);if(r&&r.unidades&&r.kilos){const e=Math.round(r.kilos/r.unidades*o*100)/100,i=Math.min(e,r.kilos),n=Math.min(o,r.unidades);h((e=>({...e,kilos:i,unidades:n})))}},error:!!g.unidades,helperText:g.unidades||"M\xe1ximo: ".concat((null===r||void 0===r?void 0:r.unidades)||0," unidades"),inputProps:{min:1,max:(null===r||void 0===r?void 0:r.unidades)||1,step:1},sx:{mb:2}}),(0,y.jsx)(P.A,{fullWidth:!0,label:"Kilos a mover",type:"number",value:v.kilos,onChange:e=>C("kilos",e.target.value),error:!!g.kilos,helperText:g.kilos||"M\xe1ximo: ".concat(((null===r||void 0===r?void 0:r.kilos)||0).toFixed(2)," kg"),inputProps:{min:.01,max:(null===r||void 0===r?void 0:r.kilos)||0,step:.01}})]})]})}),(0,y.jsxs)(M.A,{sx:{p:3,pt:0},children:[(0,y.jsx)(u.A,{onClick:N,variant:"outlined",sx:{color:"var(--color-text-secondary)"},children:"Cancelar"}),(0,y.jsx)(u.A,{onClick:()=>{if((()=>{const e={};T()||(e.location="Debe seleccionar una ubicaci\xf3n de destino");const o=parseInt(v.unidades),i=parseFloat(v.kilos);return!v.unidades||o<=0?e.unidades="Debe ingresar unidades v\xe1lidas":r&&r.unidades&&o>r.unidades&&(e.unidades="M\xe1ximo disponible: ".concat(r.unidades," unidades")),!v.kilos||i<=0?e.kilos="Debe ingresar kilos v\xe1lidos":r&&r.kilos&&i>r.kilos&&(e.kilos="M\xe1ximo disponible: ".concat(r.kilos.toFixed(2)," kg")),A(e),0===Object.keys(e).length})()){const e={selectedItem:{itemId:(null===r||void 0===r?void 0:r.itemId)||(null===r||void 0===r?void 0:r.categoria),categoria:(null===r||void 0===r?void 0:r.categoria)||"",descripcion:(null===r||void 0===r?void 0:r.descripcion)||"",proveedor:(null===r||void 0===r?void 0:r.proveedor)||null,partida:(null===r||void 0===r?void 0:r.partida)||"",kilos:parseFloat(v.kilos),unidades:parseInt(v.unidades)},data:"pasillo"===j?{pasillo:parseInt(v.pasillo)}:{rack:parseInt(v.rack),fila:parseInt(v.fila),nivel:v.nivel},id:(null===l||void 0===l?void 0:l.posicionId)||(null===l||void 0===l?void 0:l.rack)||(null===l||void 0===l?void 0:l.pasillo)};t(e),i()}},variant:"contained",sx:{backgroundColor:"var(--color-secondary)","&:hover":{backgroundColor:"var(--color-secondary-dark)"}},disabled:!T(),startIcon:(0,y.jsx)(f.A,{}),children:"Mover Stock"})]})]})};var Z=i(9070),$=i(4642);const J=e=>{let{open:o,onClose:i,item:r,posicion:l,onSubmit:t}=e;const x=(0,s.A)(),[v,h]=((0,a.A)(x.breakpoints.down("sm")),(0,n.useState)({kilos:"",unidades:""})),[g,A]=(0,n.useState)({}),[j,f]=(0,n.useState)(!1);if((0,n.useEffect)((()=>{o&&r&&k()}),[o,r]),(0,n.useEffect)((()=>{if(o&&(!r||!l)){const e=setTimeout((()=>{i()}),3e3);return()=>clearTimeout(e)}}),[o,r,l,i]),!o)return null;if(!r||!l)return(0,y.jsx)(w.A,{open:o,onClose:i,maxWidth:"sm",fullWidth:!0,children:(0,y.jsx)(W.A,{children:(0,y.jsx)(d.A,{sx:{display:"flex",justifyContent:"center",p:3},children:(0,y.jsx)(c.A,{color:"error",children:"Error: No se pudo cargar la informaci\xf3n necesaria para la correcci\xf3n."})})})});const k=()=>{h({kilos:"",unidades:""}),A({})},C=(e,o)=>{h((i=>({...i,[e]:o}))),g[e]&&A((o=>({...o,[e]:""})))},S=(e,o)=>{const i="kilos"===e?(null===r||void 0===r?void 0:r.kilos)||0:(null===r||void 0===r?void 0:r.unidades)||0,n=o/100,l=Math.round(i*n*100)/100;h((o=>({...o,[e]:l.toString()})))},z=()=>{k(),i()},D=v.kilos?parseFloat(v.kilos)/((null===r||void 0===r?void 0:r.kilos)||1)*100:0,E=v.unidades?parseInt(v.unidades)/((null===r||void 0===r?void 0:r.unidades)||1)*100:0;return(0,y.jsxs)(w.A,{open:o,onClose:z,maxWidth:"md",fullWidth:!0,PaperProps:{sx:{borderRadius:"var(--border-radius-lg)",boxShadow:"var(--shadow-lg)"}},children:[(0,y.jsxs)(I.A,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",pb:1},children:[(0,y.jsxs)(d.A,{sx:{display:"flex",alignItems:"center",gap:1},children:[(0,y.jsx)(b.A,{sx:{color:"var(--color-warning)",fontSize:28}}),(0,y.jsx)(c.A,{variant:"h6",sx:{fontWeight:600},children:"Ajustar Stock"})]}),(0,y.jsx)(m.A,{onClick:z,size:"small",children:(0,y.jsx)(G.A,{})})]}),(0,y.jsx)(W.A,{sx:{p:3},children:(0,y.jsxs)(d.A,{sx:{display:"flex",flexDirection:"column",gap:3},children:[(0,y.jsx)(V.A,{title:"Material a Ajustar",subtitle:"Informaci\xf3n del stock actual",padding:"compact",sx:{mb:0},children:(0,y.jsxs)(d.A,{sx:{display:"flex",flexDirection:"column",gap:2},children:[(0,y.jsxs)(d.A,{sx:{display:"flex",alignItems:"center",gap:1},children:[(0,y.jsx)(H.A,{sx:{color:"var(--color-primary)",fontSize:20}}),(0,y.jsxs)(c.A,{variant:"body1",sx:{fontWeight:600},children:[null===r||void 0===r?void 0:r.categoria," - ",null===r||void 0===r?void 0:r.descripcion]})]}),(0,y.jsxs)(d.A,{sx:{display:"flex",flexWrap:"wrap",gap:1},children:[(0,y.jsx)(p.A,{label:"".concat((null===r||void 0===r?void 0:r.unidades)||0," unidades"),color:"primary",size:"small",variant:"outlined"}),(0,y.jsx)(p.A,{label:"".concat(((null===r||void 0===r?void 0:r.kilos)||0).toFixed(2)," kg"),color:"secondary",size:"small",variant:"outlined"}),(null===r||void 0===r?void 0:r.partida)&&(0,y.jsx)(p.A,{label:"P: ".concat(r.partida),color:"default",size:"small",variant:"outlined"})]})]})}),(0,y.jsx)(V.A,{title:"Cantidad a Eliminar",subtitle:"Especifique cu\xe1nto stock eliminar",padding:"compact",sx:{mb:0},children:(0,y.jsxs)(d.A,{sx:{display:"flex",flexDirection:"column",gap:3},children:[(0,y.jsxs)(d.A,{children:[(0,y.jsxs)(c.A,{variant:"body2",sx:{mb:1,fontWeight:500},children:["Kilos a eliminar: ",v.kilos||0," kg"]}),(0,y.jsx)(Z.Ay,{value:D,onChange:(e,o)=>S("kilos",o),min:0,max:100,step:1,valueLabelDisplay:"auto",valueLabelFormat:e=>"".concat(Math.round(((null===r||void 0===r?void 0:r.kilos)||0)*e/100)," kg"),sx:{color:"var(--color-warning)","& .MuiSlider-thumb":{backgroundColor:"var(--color-warning)"}}}),(0,y.jsx)(P.A,{fullWidth:!0,label:"Kilos espec\xedficos",type:"number",value:v.kilos,onChange:e=>C("kilos",e.target.value),error:!!g.kilos,helperText:g.kilos||"M\xe1ximo: ".concat((null===r||void 0===r?void 0:r.kilos)||0," kg"),inputProps:{min:0,max:(null===r||void 0===r?void 0:r.kilos)||0,step:.01},size:"small"})]}),(0,y.jsxs)(d.A,{children:[(0,y.jsxs)(c.A,{variant:"body2",sx:{mb:1,fontWeight:500},children:["Unidades a eliminar: ",v.unidades||0," uds"]}),(0,y.jsx)(Z.Ay,{value:E,onChange:(e,o)=>S("unidades",o),min:0,max:100,step:1,valueLabelDisplay:"auto",valueLabelFormat:e=>"".concat(Math.round(((null===r||void 0===r?void 0:r.unidades)||0)*e/100)," uds"),sx:{color:"var(--color-warning)","& .MuiSlider-thumb":{backgroundColor:"var(--color-warning)"}}}),(0,y.jsx)(P.A,{fullWidth:!0,label:"Unidades espec\xedficas",type:"number",value:v.unidades,onChange:e=>C("unidades",e.target.value),error:!!g.unidades,helperText:g.unidades||"M\xe1ximo: ".concat((null===r||void 0===r?void 0:r.unidades)||0," unidades"),inputProps:{min:0,max:(null===r||void 0===r?void 0:r.unidades)||0,step:1},size:"small"})]}),(0,y.jsx)(u.A,{variant:"outlined",color:"warning",fullWidth:!0,onClick:()=>{h({kilos:((null===r||void 0===r?void 0:r.kilos)||0).toString(),unidades:((null===r||void 0===r?void 0:r.unidades)||0).toString()})},startIcon:(0,y.jsx)($.A,{}),sx:{borderColor:"var(--color-warning)",color:"var(--color-warning)","&:hover":{backgroundColor:"var(--color-warning)",color:"white"}},children:"Eliminar todo el stock disponible"})]})}),(0,y.jsx)(L.A,{severity:"warning",icon:(0,y.jsx)($.A,{}),sx:{backgroundColor:"rgba(255, 152, 0, 0.1)",border:"1px solid var(--color-warning)"},children:(0,y.jsxs)(c.A,{variant:"body2",children:[(0,y.jsx)("strong",{children:"Advertencia:"})," Esta acci\xf3n eliminar\xe1 permanentemente el stock seleccionado. Esta operaci\xf3n no se puede deshacer."]})})]})}),(0,y.jsxs)(M.A,{sx:{p:3,pt:0},children:[(0,y.jsx)(u.A,{onClick:z,variant:"outlined",sx:{color:"var(--color-text-secondary)"},children:"Cancelar"}),(0,y.jsx)(u.A,{onClick:()=>{if((()=>{const e={},o=parseFloat(v.kilos),i=parseInt(v.unidades);return(!v.kilos||o<0)&&(e.kilos="Debe ingresar kilos v\xe1lidos (m\xednimo 0)"),(!v.unidades||i<0)&&(e.unidades="Debe ingresar unidades v\xe1lidas (m\xednimo 0)"),A(e),0===Object.keys(e).length})()){const e=parseFloat(v.kilos),o=parseInt(v.unidades);if(e>((null===r||void 0===r?void 0:r.kilos)||0))return void A({kilos:"No puede eliminar m\xe1s de ".concat((null===r||void 0===r?void 0:r.kilos)||0," kilos disponibles")});if(o>((null===r||void 0===r?void 0:r.unidades)||0))return void A({unidades:"No puede eliminar m\xe1s de ".concat((null===r||void 0===r?void 0:r.unidades)||0," unidades disponibles")});const n={proveedor:null===r||void 0===r?void 0:r.proveedor,tipoMovimiento:"ajusteRESTA",item:{itemId:(null===r||void 0===r?void 0:r.itemId)||(null===r||void 0===r?void 0:r.id),categoria:null===r||void 0===r?void 0:r.categoria,descripcion:null===r||void 0===r?void 0:r.descripcion,proveedor:null===r||void 0===r?void 0:r.proveedor,partida:null===r||void 0===r?void 0:r.partida,kilos:null===r||void 0===r?void 0:r.kilos,unidades:null===r||void 0===r?void 0:r.unidades},kilos:e,unidades:o,partida:null===r||void 0===r?void 0:r.partida,posicion:(null===l||void 0===l?void 0:l.posicionId)||(null===l||void 0===l?void 0:l.id)||""};t(n),i()}},variant:"contained",sx:{backgroundColor:"var(--color-warning)","&:hover":{backgroundColor:"var(--color-warning-dark)"}},disabled:j||!v.kilos&&!v.unidades,startIcon:(0,y.jsx)(b.A,{}),children:j?"Eliminando...":"Eliminar Stock"})]})]})};var Q=i(8137),X=i(3211),_=i(5655),ee=i(8816);var oe=i(7518);const ie=()=>{const e=(0,r.Zp)(),o=(0,l.wA)(),i=(0,s.A)(),m=(0,a.A)(i.breakpoints.down("sm")),h=(0,a.A)(i.breakpoints.down("md")),[g,A]=(0,n.useState)(null),[j,f]=(0,n.useState)([]),[b,C]=(0,n.useState)(""),[w,I]=(0,n.useState)({rack:"",fila:"",ab:"",pasillo:""}),[W,P]=(0,n.useState)(!1),[M,z]=(0,n.useState)(!1),[D,E]=(0,n.useState)(!1),[F,L]=(0,n.useState)(null),[T,N]=(0,n.useState)(null),R=(0,l.d4)(_.h4),O=(0,l.d4)(_.tN),q=(0,l.d4)(_.V6);(0,n.useEffect)((()=>{const o=(e=>{const o=ee.y.getUser();return o||(e("/"),null)})(e);o&&A(o)}),[e]),(0,n.useEffect)((()=>{o((0,X.LM)())}),[o]),(0,n.useEffect)((()=>{const e=(0,k.Zq)(R,b,w);f(e)}),[R,b,w]);const U=()=>{(e=>{ee.y.logout(),e("/")})(e)};return g?O?(0,y.jsx)(Q.A,{user:g,onLogout:U,pageTitle:"Dep\xf3sito",children:(0,y.jsx)(t.A,{maxWidth:"lg",sx:{py:m?2:4},children:(0,y.jsx)(d.A,{sx:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",minHeight:"60vh"},children:(0,y.jsx)(c.A,{variant:"h6",sx:{color:"var(--color-text-secondary)",mb:2},children:"Cargando posiciones..."})})})}):q?(0,y.jsx)(Q.A,{user:g,onLogout:U,pageTitle:"Dep\xf3sito",children:(0,y.jsx)(t.A,{maxWidth:"lg",sx:{py:m?2:4},children:(0,y.jsxs)(V.A,{title:"Error",subtitle:"No se pudieron cargar las posiciones",sx:{maxWidth:600,mx:"auto"},children:[(0,y.jsx)(c.A,{color:"error",sx:{mb:3},children:q}),(0,y.jsx)(u.A,{variant:"contained",onClick:()=>o((0,X.LM)()),sx:{backgroundColor:"var(--color-primary)"},children:"Reintentar"})]})})}):(0,y.jsx)(Q.A,{user:g,onLogout:U,pageTitle:"Dep\xf3sito",children:(0,y.jsxs)(t.A,{maxWidth:"lg",sx:{py:m?2:4},children:[!m&&(0,y.jsxs)(d.A,{sx:{mb:4},children:[(0,y.jsx)(c.A,{variant:"h3",sx:{fontWeight:700,color:"var(--color-text-primary)",mb:.5},children:"Dep\xf3sito"}),(0,y.jsxs)(c.A,{variant:"body2",sx:{color:"var(--color-text-secondary)",mb:3},children:[j.length," de ",R.length," posiciones"]})]}),(0,y.jsx)(V.A,{title:m?"Filtros":"B\xfasqueda y Filtros",subtitle:m?"":"Encuentra r\xe1pidamente las posiciones que necesitas",sx:{mb:m?2:4},padding:m?"compact":"normal",children:(0,y.jsxs)(d.A,{sx:{display:"flex",flexDirection:"row",gap:m?.5:h?1:2,alignItems:"center",overflow:"hidden"},children:[(0,y.jsx)(d.A,{sx:{flex:m||h?"0 0 66.666%":"1",minWidth:0},children:(0,y.jsx)(x.I,{placeholder:oe.eG.DEPOSITO,onSearch:e=>{C(e)}})}),(0,y.jsx)(d.A,{sx:{flex:m||h?"0 0 33.333%":"0 0 auto",minWidth:m?"120px":h?"140px":"220px"},children:(0,y.jsx)(v.Y,{filters:w,onFilterChange:e=>{I(e)}})})]})}),(0,y.jsx)(V.A,{title:m?void 0:"Posiciones (".concat(j.length,")"),subtitle:m?void 0:"Mostrando ".concat(j.length," de ").concat(R.length," posiciones"),headerAction:m?void 0:(0,y.jsx)(p.A,{label:"".concat(R.length," total"),color:"primary",size:"small"}),padding:m?"compact":"normal",children:(0,y.jsx)(S,{posiciones:j,onPosicionClick:e=>{console.log("Posici\xf3n seleccionada:",e)},onAdicionRapida:e=>{L(e),P(!0)},onMovimientoInterno:(e,o)=>{console.log("Datos recibidos para movimiento interno:",{item:e,posicion:o}),e&&o?(N(e),L(o),z(!0)):console.error("Datos inv\xe1lidos para movimiento interno:",{item:e,posicion:o})},onCorreccion:(e,o)=>{N(e),L(o),E(!0)},searchTerm:b})}),(0,y.jsx)(K,{open:W,onClose:()=>P(!1),posicion:F,onSubmit:async e=>{try{await o((0,X.NJ)(e)).unwrap(),P(!1),L(null)}catch(q){console.error("Error en adici\xf3n r\xe1pida:",q)}}}),(0,y.jsx)(Y,{open:M,onClose:()=>{z(!1),N(null),L(null)},item:T,posicionOrigen:F,onSubmit:async e=>{try{await o((0,X.fn)(e)).unwrap(),z(!1),N(null),L(null)}catch(q){console.error("Error en movimiento interno:",q)}}}),(0,y.jsx)(J,{open:D,onClose:()=>{E(!1),N(null),L(null)},item:T,posicion:F,onSubmit:async e=>{try{E(!1),N(null),L(null)}catch(q){console.error("Error en correcci\xf3n:",q)}}})]})}):null}}}]);
//# sourceMappingURL=73.263584b1.chunk.js.map